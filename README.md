# K6 Performance Testing Framework

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
K6 Performance Testing Framework ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **K6**. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è:

‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫—É —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤  
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ OpenAPI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏  
‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á–µ—Ç–æ–≤ –≤ JSON, TXT –∏ HTML  
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤ Docker  

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **Node.js** ‚Äî –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è npm-—Å–∫—Ä–∏–ø—Ç—ã
- **Docker** ‚Äî –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **K6** ‚Äî –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ K6:
```bash
npm install -g k6
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd qa-performance
```

2Ô∏è‚É£ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ K6 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
```bash
k6 version
```

3Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:
```bash
./tests/performance/api/files/run_local.sh
```

---

## ‚ö° –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–æ–≤
./tests/performance/api/files/run_local.sh

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ (–±–µ–∑ –æ—Ç—á–µ—Ç–æ–≤)
k6 run --insecure-skip-tls-verify tests/performance/api/k6_tests/k6_test.js
```
üìå –û—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `tests/performance/api/logs/report.json` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `tests/performance/api/logs/report.txt` ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
- `tests/performance/api/logs/report.html` ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç

---

### –ó–∞–ø—É—Å–∫ –≤ Docker
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f tests/performance/api/docker/docker-compose.yml up --build

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –æ—Ç—á–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –≤:
ls ./report.*  # HTML, JSON, TXT
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
qa-performance/
‚îú‚îÄ‚îÄ tests/performance/api/
‚îÇ   ‚îú‚îÄ‚îÄ docker/               # Docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ run-tests.sh
‚îÇ   ‚îú‚îÄ‚îÄ files/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ run_local.sh      # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ k6_tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js            # –û—Å–Ω–æ–≤–Ω—ã–µ API-–º–µ—Ç–æ–¥—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ k6_test.js        # –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ openapi_parser.js # –ü–∞—Ä—Å–µ—Ä OpenAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.js     # –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.js          # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ logs/                 # –û—Ç—á–µ—Ç—ã (—Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)
‚îÇ       ‚îú‚îÄ‚îÄ report.html
‚îÇ       ‚îú‚îÄ‚îÄ report.json
‚îÇ       ‚îî‚îÄ‚îÄ report.txt
‚îî‚îÄ‚îÄ README.md
```

---

## ‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤

### 1Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–§–∞–π–ª: `k6_test.js`
```javascript
export let options = {
  stages: [
    { duration: '5s', target: 10 },
    { duration: '1m', target: 50 },
    { duration: '10s', target: 0 }
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'],
    'errors': ['rate<0.1']
  }
};
```

### 2Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö API-–∑–∞–ø—Ä–æ—Å–æ–≤
–§–∞–π–ª: `api.js`
```javascript
export function apiGet(endpoint) {
  return retryOperation(() => {
    const res = http.get(`${BASE_URL}${endpoint}`);
    check(res, { 'status is 200': (r) => r.status === 200 });
    return res;
  });
}
```

---

## üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –æ—Ç—á–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `tests/performance/api/logs/`:

| –§–∞–π–ª          | –û–ø–∏—Å–∞–Ω–∏–µ                               |
|----------------|---------------------------------------|
| `report.json` | –î–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)    |
| `report.txt`  | –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∫–∞–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏)         |
| `report.html` | –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML-–æ—Ç—á–µ—Ç           |

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1Ô∏è‚É£ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ OpenAPI
–¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–æ–≤.
```javascript
loadOpenApiSpec(`${BASE_URL}/openapi.json`);
validateObject(schema, response);
```

### 2Ô∏è‚É£ –†–µ—Ç—Ä–∏-–ª–æ–≥–∏–∫–∞
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `utils.js`).

### 3Ô∏è‚É£ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ `k6_test.js`:
```javascript
const myTrend = new Trend('my_custom_metric');
myTrend.add(response.timings.duration);
```

---

## ‚ùó –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

1Ô∏è‚É£ **–ü—Ä–æ–±–ª–µ–º—ã —Å Docker Compose**
- –û—à–∏–±–∫–∞: `docker-compose not found`
- –†–µ—à–µ–Ω–∏–µ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
```bash
docker-compose --version
```

2Ô∏è‚É£ **–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ K6: Command not found**
- –û—à–∏–±–∫–∞: `k6: command not found`
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É K6:
```bash
npm install -g k6
```

3Ô∏è‚É£ **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏**
- –û—à–∏–±–∫–∞: `OpenAPI –∑–∞–≥—Ä—É–∂–µ–Ω —Å –æ—à–∏–±–∫–æ–π`
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –ø—É—Ç—å:
```bash
curl https://<–≤–∞—à-url>/openapi.json
```

4Ô∏è‚É£ **–ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ—Ç—á–µ—Ç—ã –≤ Docker**
- –û—à–∏–±–∫–∞: `report.json not found`
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `logs` –∏ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

---

## üìå –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–≠—Ç–æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

‚úÖ –ë—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã  
‚úÖ –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å API –ø–æ OpenAPI  
‚úÖ –ü–æ–ª—É—á–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã  
‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤ Docker

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues –∏–ª–∏ Pull Requests.
